---
import type { GetStaticPathsOptions, Page } from 'astro';
import { type CollectionEntry, getCollection } from 'astro:content';
import Pagination from '../../../../../components/Pagination.astro';
import ProjectPreview from '../../../../../components/ProjectPreview.astro';
import siteConfig from '../../../../../data/site-config';
import BaseLayout from '../../../../../layouts/BaseLayout.astro';
import { getAllProjectTags, getProjectsByTag, sortItemsByDateDesc } from '../../../../../utils/data-utils';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
    const projects = (await getCollection('projects', ({ id }) => id.startsWith('fr/'))).sort(sortItemsByDateDesc);
    const tags = getAllProjectTags(projects);

    return tags.flatMap((tag) => {
        const filteredProjects = getProjectsByTag(projects, tag.id);
        return paginate(filteredProjects, {
            params: { id: tag.id },
            pageSize: siteConfig.projectsPerPage || 6,
            props: { tag }
        });
    });
}

type Props = { page: Page<CollectionEntry<'projects'>>; tag: { name: string; id: string } };

const { page, tag } = Astro.props;
const projects = page.data;
---

<BaseLayout 
    title={`Projets marqués "${tag.name}"`} 
    description={`Explorez une collection de projets sous ${tag.name}`} 
    showHeader={false}
>
    <h1 class="mb-12 font-serif text-2xl leading-tight italic sm:mb-16 sm:text-4xl">Projets marqués "{tag.name}"</h1>
    {projects.map((project) => <ProjectPreview project={project} class="mb-10 sm:mb-12" />)}
    <Pagination page={page} class="my-16 sm:my-24" />
</BaseLayout>